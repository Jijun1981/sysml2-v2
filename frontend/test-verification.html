<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>验证测试</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <h1>前端代码验证测试</h1>
    <div id="status"></div>
    <div id="results"></div>
    
    <script>
        const statusDiv = document.getElementById('status');
        const resultsDiv = document.getElementById('results');
        
        async function runTests() {
            statusDiv.innerHTML = '<h2>开始测试...</h2>';
            let allPassed = true;
            let results = [];
            
            // Test 1: Check if API is accessible
            try {
                const response = await axios.get('http://localhost:8080/api/v1/elements?projectId=test-project');
                results.push('✅ API通信成功');
                results.push(`   返回数据大小: ${JSON.stringify(response.data).length} bytes`);
            } catch (error) {
                results.push('❌ API通信失败: ' + error.message);
                allPassed = false;
            }
            
            // Test 2: Check frontend is running
            try {
                const response = await axios.get('http://localhost:3000/');
                results.push('✅ 前端服务运行正常 (port 3000)');
            } catch (error) {
                results.push('❌ 前端服务未运行: ' + error.message);
                allPassed = false;
            }
            
            // Test 3: Create a test element
            try {
                const testElement = {
                    eClass: 'RequirementDefinition',
                    declaredName: 'Test Requirement ' + Date.now(),
                    declaredShortName: 'REQ-TEST-' + Date.now()
                };
                const response = await axios.post('http://localhost:8080/api/v1/elements?projectId=test-project', testElement);
                results.push('✅ 创建元素成功');
                results.push(`   元素ID: ${response.data.elementId}`);
            } catch (error) {
                results.push('❌ 创建元素失败: ' + error.message);
                allPassed = false;
            }
            
            // Display results
            statusDiv.innerHTML = allPassed ? 
                '<h2 style="color: green">✅ 所有测试通过</h2>' : 
                '<h2 style="color: red">❌ 部分测试失败</h2>';
            
            resultsDiv.innerHTML = '<h3>测试结果:</h3><pre>' + results.join('\n') + '</pre>';
            
            if (allPassed) {
                resultsDiv.innerHTML += `
                    <hr>
                    <h3>✅ 系统准备就绪</h3>
                    <p>请访问 <a href="http://localhost:3000">http://localhost:3000</a> 并执行以下操作：</p>
                    <ol>
                        <li>按 F12 打开开发者工具</li>
                        <li>按 Ctrl+Shift+R 强制刷新页面</li>
                        <li>检查控制台是否还有错误</li>
                    </ol>
                `;
            }
        }
        
        // Run tests on load
        runTests();
    </script>
</body>
</html>