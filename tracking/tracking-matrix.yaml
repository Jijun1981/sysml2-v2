# SysML v2 MVP 追踪矩阵
# 版本: 4.0 - 极简EMF基础平台
# 更新时间: 2025-08-25
# 说明: 基于清理后的极简架构，追踪核心EMF功能实现状态

metadata:
  project: SysML v2 MVP - EMF Core Platform
  version: "4.0.0-EMF-Core"
  created: "2025-08-25"
  updated: "2025-08-25T12:00:00Z"
  status: "EMF核心基础已建立"
  architecture_status:
    current: "Minimal EMF Foundation"
    description: "极简EMF基础平台，只保留7个核心文件"
    core_components:
      - "EMFModelRegistry - 元模型注册（182个EClass）"
      - "FileModelRepository - JSON持久化"
      - "PilotEMFService - EMF工具方法"
      - "Application - Spring Boot启动"
      - "GlobalExceptionHandler - 异常处理"
    data_status: "Demo数据完整（21个对象）"

# 史诗级任务（根据需求文档）
epics:
  - id: EPIC-A
    title: "架构与数据一致性"
    priority: P0
    status: "部分实现"
    description: "单一数据源（SSOT）架构"
    
  - id: EPIC-B
    title: "EMF基座与持久化"
    priority: P0
    status: "核心完成"
    description: "EMF模型注册、JSON序列化、数据存储"
    
  - id: EPIC-C
    title: "需求与追溯管理"
    priority: P0
    status: "待实现"
    description: "领域特定接口的需求和追溯管理"
    
  - id: EPIC-D
    title: "三视图联动"
    priority: P0
    status: "待实现"
    description: "树、表、图视图的数据展示"
    
  - id: EPIC-E
    title: "静态校验"
    priority: P0
    status: "待实现"
    description: "核心业务规则验证"
    
  - id: EPIC-F
    title: "离线构建与交付"
    priority: P0
    status: "待实现"
    description: "Maven离线构建支持"

# 用户故事
stories:
  # EPIC A - 架构与数据一致性
  - id: STORY-A1
    epic: EPIC-A
    title: "单一数据源（SSOT）"
    priority: P0
    status: "基础完成"
    description: "EMF Resource作为唯一数据源"
    
  - id: STORY-A2
    epic: EPIC-A
    title: "系统状态检查"
    priority: P2
    status: "MVP不实现"
    description: "健康检查接口（MVP阶段跳过）"
    
  # EPIC B - EMF基座与持久化
  - id: STORY-B1
    epic: EPIC-B
    title: "完整Pilot Ecore注册 & JSON资源工厂"
    priority: P0
    status: "已完成"
    description: "加载182个EClass，注册JSON序列化"
    
  - id: STORY-B2
    epic: EPIC-B
    title: "统一工厂创建与DTO映射"
    priority: P0
    status: "部分完成"
    description: "PilotEMFService提供基础工具方法"
    
  - id: STORY-B3
    epic: EPIC-B
    title: "项目导入/导出（JSON）"
    priority: P0
    status: "基础完成"
    description: "FileModelRepository支持JSON存储"
    
  - id: STORY-B4
    epic: EPIC-B
    title: "快速原型验证"
    priority: P1
    status: "待实现"
    description: "Spring Shell CLI支持"
    
  - id: STORY-B5
    epic: EPIC-B
    title: "领域特定接口"
    priority: P0
    status: "待实现"
    description: "需求、部件等领域服务接口"

# 需求定义（按需求文档）
requirements:
  # STORY A1 - 单一数据源
  - id: REQ-A1-1
    story: STORY-A1
    title: "数据源唯一"
    priority: P0
    status: "基础完成"
    implementation_status:
      emf_resource: "✅ EMF Resource统一管理"
      file_repository: "✅ FileModelRepository实现"
      view_sync: "❌ 视图同步机制未实现"
    
  - id: REQ-A1-2
    story: STORY-A1
    title: "视图为投影"
    priority: P0
    status: "待实现"
    
  - id: REQ-A1-3
    story: STORY-A1
    title: "性能底线"
    priority: P0
    status: "待验证"
    acceptance_criteria: "500节点/1000边，响应<500ms"
    
  # STORY B1 - Pilot元模型
  - id: REQ-B1-1
    story: STORY-B1
    title: "完整Pilot元模型注册"
    priority: P0
    status: "已实现"
    implementation:
      file: "EMFModelRegistry.java"
      details: "成功加载182个EClass，命名空间动态获取"
      verification: "启动日志显示：注册的EClass数量: 182"
    test_status: "✅ 测试通过"
    test_file: "EMFCoreSimpleTest.java#testMetamodelRegistration"
    
  - id: REQ-B1-2
    story: STORY-B1
    title: "JSON工厂"
    priority: P0
    status: "已实现"
    implementation:
      file: "EMFModelRegistry.java"
      details: "使用sirius-emfjson库注册JSON工厂"
    test_status: "✅ 测试通过"
    test_file: "EMFCoreSimpleTest.java#testSaveAndLoad"
    
  - id: REQ-B1-3
    story: STORY-B1
    title: "回读一致性"
    priority: P0
    status: "已实现"
    implementation:
      file: "FileModelRepository.java"
      details: "保存和加载JSON，保持ID和引用一致"
    test_status: "✅ 测试通过"
    test_file: "EMFCoreSimpleTest.java#testSaveAndLoad"
    
  - id: REQ-B1-4
    story: STORY-B1
    title: "Demo数据"
    priority: P0
    status: "已实现"
    data_files:
      - "demo-project.json (21个对象)"
      - "ev-battery-demo.json (电池系统演示)"
      - "small/medium/large-project.json"
    
  # STORY B2 - 工厂创建
  - id: REQ-B2-1
    story: STORY-B2
    title: "创建API"
    priority: P0
    status: "基础完成"
    implementation:
      file: "PilotEMFService.java"
      methods: ["createRequirementDefinition", "createRequirementUsage", "createTraceDependency", "createElement"]
    test_status: "✅ 测试通过"
    test_file: "EMFCoreSimpleTest.java#testCreateObjects"
    
  - id: REQ-B2-2
    story: STORY-B2
    title: "默认值"
    priority: P0
    status: "部分完成"
    
  - id: REQ-B2-3
    story: STORY-B2
    title: "ID稳定"
    priority: P0
    status: "已实现"
    test_status: "✅ 测试通过"
    test_file: "EMFCoreSimpleTest.java#testSaveAndLoad"
    
  - id: REQ-B2-4
    story: STORY-B2
    title: "DTO选择性映射"
    priority: P0
    status: "待实现"
    notes: "需要创建DTO层"
    
  # STORY B3 - 导入导出
  - id: REQ-B3-1
    story: STORY-B3
    title: "导出JSON"
    priority: P0
    status: "基础完成"
    implementation:
      file: "FileModelRepository.java"
      method: "saveModel"
    
  - id: REQ-B3-2
    story: STORY-B3
    title: "导入JSON"
    priority: P0
    status: "基础完成"
    implementation:
      file: "FileModelRepository.java"
      method: "loadModel"
    
  - id: REQ-B3-3
    story: STORY-B3
    title: "一致性"
    priority: P0
    status: "已验证"
    
  # STORY B5 - 领域特定接口
  - id: REQ-B5-1
    story: STORY-B5
    title: "需求领域接口"
    priority: P0
    status: "待实现"
    required_components:
      - "RequirementController (待创建)"
      - "RequirementService (待创建)"
    
  - id: REQ-B5-2
    story: STORY-B5
    title: "部件领域接口"
    priority: P0
    status: "待实现"
    
  - id: REQ-B5-3
    story: STORY-B5
    title: "内部EMF工具层"
    priority: P0
    status: "基础完成"
    implementation:
      file: "PilotEMFService.java"
      notes: "已实现EMF工具方法，待封装访问控制"
    
  - id: REQ-B5-4
    story: STORY-B5
    title: "扩展新类型"
    priority: P0
    status: "架构支持"
    notes: "动态EMF支持零代码扩展"
    
  - id: REQ-B5-5
    story: STORY-B5
    title: "QUDV单位量纲校验"
    priority: P0
    status: "待实现"

# 代码实现状态
code_implementations:
  # 核心保留文件
  - file: backend/src/main/java/com/sysml/mvp/Application.java
    type: infrastructure
    status: "已实现"
    description: "Spring Boot启动类"
    requirements: []
    
  - file: backend/src/main/java/com/sysml/mvp/model/EMFModelRegistry.java
    type: core
    status: "已实现"
    description: "EMF元模型注册，加载182个EClass"
    requirements: [REQ-B1-1, REQ-B1-2]
    capabilities:
      - "加载SysML.ecore文件"
      - "注册到EPackage.Registry"
      - "配置JSON资源工厂"
    
  - file: backend/src/main/java/com/sysml/mvp/repository/FileModelRepository.java
    type: core
    status: "已实现"
    description: "文件系统JSON持久化"
    requirements: [REQ-B1-3, REQ-B3-1, REQ-B3-2, REQ-B3-3]
    capabilities:
      - "加载/保存EMF Resource"
      - "JSON序列化/反序列化"
      - "项目文件管理"
    
  - file: backend/src/main/java/com/sysml/mvp/service/PilotEMFService.java
    type: core
    status: "已实现"
    description: "EMF工具方法封装"
    requirements: [REQ-B2-1, REQ-B5-3]
    capabilities:
      - "动态创建EObject"
      - "属性访问eGet/eSet"
      - "类型查询和验证"
    
  - file: backend/src/main/java/com/sysml/mvp/exception/GlobalExceptionHandler.java
    type: infrastructure
    status: "已实现"
    description: "全局异常处理"
    requirements: []
    
  - file: backend/src/main/resources/application.yml
    type: configuration
    status: "已配置"
    description: "Spring Boot配置文件"
    
  # 测试文件
  - file: backend/src/test/java/com/sysml/mvp/EMFCoreSimpleTest.java
    type: test
    status: "已实现"
    description: "核心EMF功能简化测试"
    requirements: [REQ-B1-1, REQ-B1-2, REQ-B1-3, REQ-B2-1, REQ-B2-3]
    test_methods:
      - "testMetamodelRegistration: 验证182个EClass注册"
      - "testCreateObjects: 验证对象创建功能"
      - "testSaveAndLoad: 验证JSON序列化和一致性"
  
  # 数据文件
  - file: backend/data/demo-project.json
    type: data
    status: "已创建"
    description: "演示数据（8个Definition，5个Trace）"
    requirements: [REQ-B1-4]
    
  - file: backend/data/ev-battery-demo.json
    type: data
    status: "已创建"
    description: "电池系统演示数据"
    requirements: [REQ-B1-4]

# 待实现组件（下一步开发）
pending_components:
  controllers:
    - name: RequirementController
      priority: P0
      endpoints:
        - "POST /api/v1/requirements"
        - "GET /api/v1/requirements"
        - "PATCH /api/v1/requirements/{id}"
      requirements: [REQ-B5-1, REQ-C1-1, REQ-C1-2, REQ-C1-3]
      
    - name: TraceController
      priority: P0
      endpoints:
        - "POST /api/v1/traces"
        - "GET /api/v1/traces"
      requirements: [REQ-C3-1, REQ-C3-2]
      
  services:
    - name: RequirementService
      priority: P0
      responsibilities:
        - "需求业务逻辑"
        - "reqId唯一性验证"
        - "DTO映射"
      requirements: [REQ-B5-1, REQ-C1-1]
      
    - name: TraceService
      priority: P0
      responsibilities:
        - "追溯关系管理"
        - "类型映射（Trace→Dependency）"
        - "语义约束验证"
      requirements: [REQ-C3-1, REQ-C3-4]
      
  dtos:
    - name: RequirementDTO
      fields: ["id", "declaredShortName", "declaredName", "documentation"]
      requirements: [REQ-B2-4]
      
    - name: TraceDTO
      fields: ["id", "source", "target", "type"]
      requirements: [REQ-C3-1]

# 统计摘要
statistics:
  current_state:
    total_files: 7
    core_files: 4  # EMF相关核心文件
    infrastructure_files: 3  # 基础设施文件
    demo_data_files: 5
    
  requirements_status:
    total: 30  # 根据需求文档统计
    implemented: 8  # 已实现的需求
    partially_implemented: 4  # 部分实现
    pending: 18  # 待实现
    tested: 5  # 已通过测试验证
    
  emf_capabilities:
    metamodel_classes: 182
    demo_objects: 21
    serialization: "JSON (sirius-emfjson)"
    storage: "FileSystem"
    
  next_priorities:
    p0_requirements: 10  # 必须实现的P0需求
    p1_requirements: 2   # P1可选需求
    p2_requirements: 1   # P2后续需求

# 下一步行动计划
next_steps:
  phase_1_foundation:
    - task: "创建RequirementController和RequirementService"
      priority: P0
      requirements: [REQ-B5-1, REQ-C1-1, REQ-C1-2]
      
    - task: "创建TraceController和TraceService"
      priority: P0
      requirements: [REQ-C3-1, REQ-C3-2]
      
    - task: "实现基础DTO层"
      priority: P0
      requirements: [REQ-B2-4]
      
  phase_2_validation:
    - task: "实现reqId唯一性验证"
      priority: P0
      requirements: [REQ-C1-1]
      
    - task: "实现追溯语义约束"
      priority: P0
      requirements: [REQ-C3-4]
      
  phase_3_views:
    - task: "实现视图查询接口"
      priority: P0
      requirements: [REQ-D1-1, REQ-D2-1, REQ-D3-1]

# 版本历史
version_history:
  - version: "4.1"
    date: "2025-08-25T18:00"
    author: "Claude"
    changes:
      - "添加测试状态跟踪"
      - "更新已实现功能的测试结果"
      - "添加测试文件引用"
      - "创建EMFCoreSimpleTest.java验证核心功能"
  - version: "4.0"
    date: "2025-08-25"
    author: "Claude"
    changes:
      - "基于需求文档v3.1创建全新追踪矩阵"
      - "反映极简EMF基础平台现状（7个核心文件）"
      - "明确标识已实现vs待实现功能"
      - "提供清晰的下一步开发路线图"
      - "聚焦EMF核心价值和基础能力"