# REQ-EDIT-001: 模型元素编辑对话框功能

## 需求概述
实现一个模态对话框，允许用户编辑SysML模型元素的详细信息，特别是RequirementUsage与RequirementDefinition的关联关系。

## 用户故事
作为一个系统建模人员，我希望能够通过一个直观的对话框编辑模型元素的属性，包括从下拉列表中选择关联的Definition，以便快速准确地建立模型元素之间的关系。

## 详细需求

### REQ-EDIT-001-1: 编辑按钮触发
- **Given**: 用户在表格视图中查看模型元素列表
- **When**: 用户点击某一行的"编辑"按钮
- **Then**: 
  - 弹出模态对话框
  - 对话框显示该元素的所有可编辑属性
  - 对话框标题显示"编辑 [元素类型]"

### REQ-EDIT-001-2: 表单字段动态生成
- **Given**: 不同类型的元素有不同的属性
- **When**: 打开编辑对话框
- **Then**:
  - 自动识别元素类型（RequirementDefinition/RequirementUsage）
  - 显示对应的表单字段
  - 必填字段标记红色星号
  - 只读字段显示为禁用状态

### REQ-EDIT-001-3: RequirementDefinition引用选择
- **Given**: 编辑RequirementUsage元素
- **When**: 用户需要设置requirementDefinition属性
- **Then**:
  - 显示下拉选择框
  - 下拉列表包含所有可用的RequirementDefinition
  - 显示格式：[elementId] - [declaredName]
  - 支持搜索过滤
  - 允许清空选择（可选字段）

### REQ-EDIT-001-4: 表单验证
- **Given**: 用户在对话框中修改字段
- **When**: 用户点击"保存"按钮
- **Then**:
  - 验证必填字段不为空
  - 验证引用的对象存在
  - 验证数据格式正确
  - 如有错误，显示具体错误信息
  - 错误字段高亮显示

### REQ-EDIT-001-5: 保存更新
- **Given**: 表单验证通过
- **When**: 用户确认保存
- **Then**:
  - 调用后端API更新数据
  - 显示加载状态
  - 成功后关闭对话框
  - 刷新表格数据
  - 显示成功提示

### REQ-EDIT-001-6: 取消操作
- **Given**: 用户打开编辑对话框
- **When**: 用户点击"取消"按钮或ESC键
- **Then**:
  - 关闭对话框
  - 不保存任何修改
  - 如有未保存的修改，提示确认

### REQ-EDIT-001-7: 错误处理
- **Given**: 保存过程中发生错误
- **When**: 后端返回错误
- **Then**:
  - 显示错误消息
  - 保持对话框打开
  - 允许用户修正后重试

## 界面设计要求

### 对话框布局
```
┌─────────────────────────────────────┐
│  编辑 RequirementUsage              X │
├─────────────────────────────────────┤
│                                     │
│  Element ID: REQ-001 (只读)        │
│                                     │
│  * 名称:                            │
│  ┌─────────────────────────────┐   │
│  │ API响应时间                  │   │
│  └─────────────────────────────┘   │
│                                     │
│  简称:                              │
│  ┌─────────────────────────────┐   │
│  │ API-Response               │   │
│  └─────────────────────────────┘   │
│                                     │
│  关联定义:                          │
│  ┌─────────────────────────────┐   │
│  │ ▼ 选择Definition...        │   │
│  └─────────────────────────────┘   │
│    □ DEF-PERF - 性能需求模板       │
│    □ DEF-SEC - 安全需求模板        │
│    □ DEF-UI - 界面需求模板         │
│                                     │
│  描述:                              │
│  ┌─────────────────────────────┐   │
│  │                             │   │
│  │                             │   │
│  └─────────────────────────────┘   │
│                                     │
│  ┌──────┐  ┌──────┐               │
│  │ 取消 │  │ 保存 │               │
│  └──────┘  └──────┘               │
└─────────────────────────────────────┘
```

## 技术实现要求

### 前端组件
- 使用Ant Design的Modal和Form组件
- 支持表单自动布局
- 使用Select组件实现下拉选择
- 支持键盘快捷键（Enter保存，ESC取消）

### API接口
- 使用现有的PATCH接口更新元素
- `PATCH /api/v1/requirements/{elementId}`
- `PATCH /api/v1/requirements/usages/{elementId}`

### 状态管理
- 使用React Hook管理表单状态
- 使用Context共享编辑状态
- 支持乐观更新

## 验收标准

1. ✅ 点击编辑按钮弹出对话框
2. ✅ 表单字段根据元素类型动态显示
3. ✅ RequirementUsage可以从下拉列表选择Definition
4. ✅ 表单验证工作正常
5. ✅ 保存成功后数据更新并刷新表格
6. ✅ 取消操作不影响数据
7. ✅ 错误处理友好且明确
8. ✅ 界面响应快速流畅

## 测试场景

### 场景1: 编辑RequirementUsage关联
1. 打开RequirementUsage列表
2. 点击某个Usage的编辑按钮
3. 从下拉列表选择一个Definition
4. 点击保存
5. 验证表格中"关联定义"列更新

### 场景2: 清空关联关系
1. 编辑已有关联的RequirementUsage
2. 清空requirementDefinition选择
3. 保存
4. 验证关联关系被清除

### 场景3: 验证失败
1. 编辑RequirementDefinition
2. 清空必填的reqId字段
3. 点击保存
4. 验证显示错误信息
5. 修正后重新保存

### 场景4: 并发编辑冲突
1. 两个用户同时编辑同一元素
2. 第二个用户保存时检测版本冲突
3. 提示刷新数据

## 非功能需求

- **性能**: 对话框打开时间 < 200ms
- **可用性**: 支持Tab键导航
- **兼容性**: 支持Chrome、Firefox、Safari最新版本
- **响应式**: 适配不同屏幕尺寸

## 依赖关系

- 依赖REQ-TDD-001（RequirementDefinition引用功能）
- 依赖后端PATCH接口
- 依赖前端表格视图组件

## 实现优先级

1. P0: 基础编辑对话框功能
2. P1: RequirementDefinition下拉选择
3. P1: 表单验证
4. P2: 搜索过滤功能
5. P3: 键盘快捷键支持

## 风险和限制

- 大量Definition时下拉列表性能问题（建议分页或虚拟滚动）
- 网络延迟时的用户体验问题（需要加载状态）
- 并发编辑冲突（需要版本控制机制）